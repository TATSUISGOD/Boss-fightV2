<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¿ãƒƒãƒ—ã§ãƒœã‚¹ã‚’å€’ã›ï¼</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: sans-serif;
  background: #111;
  color: #fff;
  text-align: center;
  margin: 0;
  padding: 20px;
}
button {
  font-size: 18px;
  padding: 12px 20px;
  margin: 10px;
}
.boss {
  font-size: 90px;
}
.hp-bar {
  width: 80%;
  height: 20px;
  background: #444;
  margin: 10px auto;
  border-radius: 10px;
  overflow: hidden;
}
.hp {
  height: 100%;
  background: red;
  width: 100%;
}
.hidden {
  display: none;
}
</style>
</head>
<body>

<h1>ğŸ”¥ ã‚¿ãƒƒãƒ—ã§ãƒœã‚¹ã‚’å€’ã›ï¼ ğŸ”¥</h1>

<!-- ãƒœã‚¹é¸æŠ -->
<div id="selectScreen">
  <h2>ãƒœã‚¹ã‚’é¸ã¹</h2>
  <button onclick="startGame('ã‚¹ãƒ©ã‚¤ãƒ ',100,'ğŸŸ¢')">ã‚¹ãƒ©ã‚¤ãƒ ï¼ˆHP100ï¼‰</button><br>
  <button onclick="startGame('ã‚ªãƒ¼ã‚¯',300,'ğŸ‘¹')">ã‚ªãƒ¼ã‚¯ï¼ˆHP300ï¼‰</button><br>
  <button onclick="startGame('ãƒ‰ãƒ©ã‚´ãƒ³',500,'ğŸ‰')">ãƒ‰ãƒ©ã‚´ãƒ³ï¼ˆHP500ï¼‰</button>
</div>

<!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
<div id="gameScreen" class="hidden">
  <h2 id="bossName"></h2>
  <div class="boss" id="bossIcon"></div>

  <div class="hp-bar">
    <div class="hp" id="hp"></div>
  </div>
  <p>HP: <span id="hpText"></span></p>

  <button id="tapBtn">ã‚¿ãƒƒãƒ—ï¼</button>
</div>

<!-- çµæœ -->
<div id="resultScreen" class="hidden">
  <h2 id="resultText"></h2>
  <div id="ranking"></div>
  <button onclick="location.reload()">ã‚‚ã†ä¸€åº¦</button>
</div>

<script>
let bossHp, maxHp, tapCount = 0, startTime;
let bossKey = "";

const hpBar = document.getElementById("hp");
const hpText = document.getElementById("hpText");
const bossName = document.getElementById("bossName");
const bossIcon = document.getElementById("bossIcon");

const selectScreen = document.getElementById("selectScreen");
const gameScreen = document.getElementById("gameScreen");
const resultScreen = document.getElementById("resultScreen");
const resultText = document.getElementById("resultText");
const rankingDiv = document.getElementById("ranking");

// ===== åŠ¹æœéŸ³ =====
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function tapSound() {
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.frequency.value = 600;
  g.gain.value = 0.05;
  o.connect(g);
  g.connect(audioCtx.destination);
  o.start();
  o.stop(audioCtx.currentTime + 0.05);
}

function clearSound() {
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.frequency.value = 300;
  g.gain.value = 0.1;
  o.connect(g);
  g.connect(audioCtx.destination);
  o.start();
  o.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.3);
  o.stop(audioCtx.currentTime + 0.3);
}

// ===== ã‚²ãƒ¼ãƒ é–‹å§‹ =====
function startGame(name, hp, icon) {
  audioCtx.resume();

  bossName.textContent = name;
  bossIcon.textContent = icon;
  bossHp = hp;
  maxHp = hp;
  bossKey = name;

  hpText.textContent = bossHp;
  hpBar.style.width = "100%";

  selectScreen.classList.add("hidden");
  gameScreen.classList.remove("hidden");

  startTime = Date.now();
}

// ===== ã‚¿ãƒƒãƒ—å‡¦ç† =====
document.getElementById("tapBtn").addEventListener("click", () => {
  tapSound();
  tapCount++;

  let damage = (tapCount % 10 === 0) ? 2 : 1;
  bossHp -= damage;
  if (bossHp < 0) bossHp = 0;

  hpText.textContent = bossHp;
  hpBar.style.width = (bossHp / maxHp * 100) + "%";

  if (bossHp === 0) {
    clearSound();
    finishGame();
  }
});

// ===== çµ‚äº†å‡¦ç† =====
function finishGame() {
  const time = ((Date.now() - startTime) / 1000).toFixed(2);
  saveRanking(bossKey, time);

  gameScreen.classList.add("hidden");
  resultScreen.classList.remove("hidden");

  resultText.textContent = `${bossKey} æ’ƒç ´ï¼ ã‚¿ã‚¤ãƒ ï¼š${time} ç§’`;
  showRanking(bossKey);
}

// ===== ãƒ©ãƒ³ã‚­ãƒ³ã‚° =====
function saveRanking(key, time) {
  const data = JSON.parse(localStorage.getItem(key) || "[]");
  data.push(Number(time));
  data.sort((a,b) => a - b);
  localStorage.setItem(key, JSON.stringify(data.slice(0,5)));
}

function showRanking(key) {
  const data = JSON.parse(localStorage.getItem(key) || "[]");
  let html = "<h3>ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h3><ol>";
  data.forEach(t => html += `<li>${t} ç§’</li>`);
  html += "</ol>";
  rankingDiv.innerHTML = html;
}
</script>

</body>
</html>
